<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead2Business - SAM Business Database</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 40px; color: white; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .search-box { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; backdrop-filter: blur(10px); }
        .search-form { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px; }
        input, select { padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        button { padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: transform 0.2s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .quick-search { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        .results { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        .results-header { padding: 20px; border-bottom: 1px solid #eee; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center; }
        .business-card { padding: 20px; border-bottom: 1px solid #f0f0f0; transition: background-color 0.2s; }
        .business-card:hover { background: #f8f9fa; }
        .business-name { font-weight: bold; color: #667eea; margin-bottom: 8px; font-size: 1.1rem; }
        .business-details { color: #666; font-size: 14px; line-height: 1.5; }
        .business-meta { display: flex; gap: 15px; margin-top: 8px; font-size: 13px; }
        .meta-item { background: #f1f3f4; padding: 4px 8px; border-radius: 4px; }
        .loading, .welcome { text-align: center; padding: 60px 20px; color: #666; }
        .error { background: #fee; color: #c33; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #c33; }
        .pagination { display: flex; justify-content: center; gap: 8px; padding: 25px; background: #f8f9fa; }
        .page-btn { padding: 10px 16px; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 6px; transition: all 0.2s; }
        .page-btn:hover { border-color: #667eea; }
        .page-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 14px; }
        @media (max-width: 768px) {
            .search-form { grid-template-columns: 1fr; }
            .header h1 { font-size: 2rem; }
            .stats-bar { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Lead2Business</h1>
            <p>Search 500,000+ US Government Registered Businesses</p>
        </div>

        <div id="stats-bar" class="stats-bar">
            <!-- Stats will be loaded dynamically -->
        </div>

        <div class="search-box">
            <div class="search-form">
                <div class="form-group">
                    <label for="state">üìç State</label>
                    <input type="text" id="state" placeholder="CA, NY, TX...">
                </div>
                <div class="form-group">
                    <label for="naics">üè¢ NAICS Code</label>
                    <input type="text" id="naics" placeholder="541611, 484122...">
                </div>
                <div class="form-group">
                    <label for="city">üèôÔ∏è City</label>
                    <input type="text" id="city" placeholder="Los Angeles...">
                </div>
                <div class="form-group">
                    <button onclick="searchBusinesses()">üîç Search</button>
                </div>
            </div>
            <div class="quick-search">
                <div class="form-group">
                    <label for="quickSearch">‚ö° Quick Search (Name, Industry, Location...)</label>
                    <input type="text" id="quickSearch" placeholder="Search across all business fields..." onkeypress="handleQuickSearch(event)">
                </div>
            </div>
        </div>

        <div id="results-container">
            <div class="welcome">
                <h3>Welcome to Lead2Business!</h3>
                <p>Use the search tools above to find US government registered businesses</p>
                <p style="margin-top: 20px; font-size: 14px; color: #888;">
                    üí° <strong>Tip:</strong> Try searching by state, industry code, or business name
                </p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://sam-leads-api-production.up.railway.app';
        let currentPage = 1;
        let currentResults = null;

        // Load stats on page load
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const data = await response.json();
                if (data.success) {
                    displayStats(data.statistics);
                }
            } catch (error) {
                document.getElementById('stats-bar').innerHTML = '<div class="stat-card"><div class="stat-number'>500K+</div><div class="stat-label">Business Records</div></div>';
            }
        }

        function displayStats(stats) {
            const statsBar = document.getElementById('stats-bar');
            statsBar.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total_businesses?.toLocaleString() || '500K+'}</div>
                    <div class="stat-label">Total Businesses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.top_states?.[0]?.count.toLocaleString() || '50K+'}</div>
                    <div class="stat-label">${stats.top_states?.[0]?.state || 'Top State'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.top_naics_codes?.[0]?.count.toLocaleString() || '10K+'}</div>
                    <div class="stat-label">NAICS ${stats.top_naics_codes?.[0]?.naics || 'Sector'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">50+</div>
                    <div class="stat-label">Search Fields</div>
                </div>
            `;
        }

        async function searchBusinesses() {
            const state = document.getElementById('state').value;
            const naics = document.getElementById('naics').value;
            const city = document.getElementById('city').value;

            showLoading('üîç Searching businesses...');
            
            try {
                let url = `${API_BASE}/leads?page=${currentPage}&limit=20`;
                if (state) url += `&state=${encodeURIComponent(state)}`;
                if (naics) url += `&naics_code=${encodeURIComponent(naics)}`;
                if (city) url += `&city=${encodeURIComponent(city)}`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.success) {
                    currentResults = data;
                    displayResults(data);
                } else {
                    showError(data.error || 'Search failed. Please try again.');
                }
            } catch (error) {
                showError('Network error. Please check your connection.');
            }
        }

        async function quickSearch(query) {
            if (!query.trim()) return;
            
            showLoading('‚ö° Searching across all fields...');
            
            try {
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}&page=1&limit=20`);
                const data = await response.json();

                if (data.success) {
                    currentResults = data;
                    displayResults(data);
                } else {
                    showError(data.error || 'Quick search failed.');
                }
            } catch (error) {
                showError('Network error during search.');
            }
        }

        function displayResults(data) {
            const container = document.getElementById('results-container');
            
            if (!data.leads || data.leads.length === 0) {
                container.innerHTML = '<div class="loading"><p>‚ùå No businesses found matching your criteria</p><p style="margin-top: 10px; font-size: 14px; color: #888;">Try different search terms or broaden your search</p></div>';
                return;
            }

            let html = `
                <div class="results">
                    <div class="results-header">
                        <h3>üéØ Found ${data.total.toLocaleString()} businesses</h3>
                        <span>üìä Showing ${data.leads.length} results ‚Ä¢ Page ${currentPage}</span>
                    </div>
            `;

            data.leads.forEach(business => {
                html += `
                    <div class="business-card" onclick="showBusinessDetail('${business.UNIQUE_ENTITY_IDENTIFIER_SAM}')" style="cursor: pointer;">
                        <div class="business-name">${escapeHtml(business.LEGAL_BUSINESS_NAME || 'N/A')}</div>
                        <div class="business-details">
                            ${business.PHYSICAL_ADDRESS_CITY ? escapeHtml(business.PHYSICAL_ADDRESS_CITY) : ''}${business.PHYSICAL_ADDRESS_PROVINCE_OR_STATE ? ', ' + escapeHtml(business.PHYSICAL_ADDRESS_PROVINCE_OR_STATE) : ''}
                            ${business.PRIMARY_NAICS ? ' ‚Ä¢ NAICS: ' + escapeHtml(business.PRIMARY_NAICS) : ''}
                        </div>
                        <div class="business-meta">
                            ${business.BUS_TYPE_STRING ? '<span class="meta-item">üè∑Ô∏è ' + escapeHtml(business.BUS_TYPE_STRING) + '</span>' : ''}
                            ${business.ENTITY_STRUCTURE ? '<span class="meta-item">üè¢ ' + escapeHtml(business.ENTITY_STRUCTURE) + '</span>' : ''}
                            ${business.NAICS_SECTOR ? '<span class="meta-item">üìà ' + escapeHtml(business.NAICS_SECTOR) + '</span>' : ''}
                        </div>
                        ${business.FULL_ADDRESS ? `<div class="business-details" style="margin-top: 8px; color: #888;">üìç ${escapeHtml(business.FULL_ADDRESS)}</div>` : ''}
                    </div>
                `;
            });

            // Pagination
            if (data.total > 20) {
                const totalPages = Math.ceil(data.total / 20);
                html += '<div class="pagination">';
                // Previous button
                if (currentPage > 1) {
                    html += `<button class="page-btn" onclick="goToPage(${currentPage - 1})">‚Üê Previous</button>`;
                }
                // Page numbers
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, startPage + 4);
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
                }
                // Next button
                if (currentPage < totalPages) {
                    html += `<button class="page-btn" onclick="goToPage(${currentPage + 1})">Next ‚Üí</button>`;
                }
                html += '</div>';
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function showBusinessDetail(samId) {
            alert('Business detail view for: ' + samId + '\n\nThis would show complete business details in a future version.');
        }

        function goToPage(page) {
            currentPage = page;
            if (document.getElementById('quickSearch').value) {
                quickSearch(document.getElementById('quickSearch').value);
            } else {
                searchBusinesses();
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handleQuickSearch(event) {
            if (event.key === 'Enter') {
                const query = document.getElementById('quickSearch').value;
                if (query.trim()) {
                    currentPage = 1;
                    quickSearch(query);
                }
            }
        }

        function showLoading(message) {
            document.getElementById('results-container').innerHTML = `<div class="loading"><p>${message}</p></div>`;
        }

        function showError(message) {
            document.getElementById('results-container').innerHTML = `<div class="error">${message}</div>`;
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe.toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Initialize
        loadStats();
    </script>
</body>
</html>